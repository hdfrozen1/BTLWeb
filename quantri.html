<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Qu·∫£n l√Ω ƒëƒÉng k√Ω xe m√°y</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background-color: #f5f7fa;
      margin: 0;
      padding: 0;
      color: #333;
    }

    header {
      background: #2d6cdf;
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 1.6em;
      letter-spacing: 1px;
    }

    main {
      padding: 20px;
      max-width: 1000px;
      margin: 0 auto;
    }

    .form-section, .table-section {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 1px 6px rgba(0, 0, 0, 0.1);
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 10px;
    }

    label {
      font-weight: bold;
      min-width: 90px;
    }

    input {
      flex: 1;
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .button-group {
      margin-top: 10px;
    }

    button {
      padding: 8px 15px;
      margin-right: 10px;
      border: none;
      border-radius: 6px;
      background: #2d6cdf;
      color: white;
      cursor: pointer;
      transition: 0.2s;
    }

    button:hover {
      background: #184fb8;
    }

    .search-section {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 15px;
    }

    select, .search-input {
      padding: 6px 10px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      text-align: left;
    }

    th {
      background: #2d6cdf;
      color: white;
      padding: 10px;
    }

    td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
    }

    tr:hover {
      background: #eef4ff;
    }

    .footer {
      text-align: right;
      font-style: italic;
      padding: 10px;
      color: #666;
    }
  </style>
</head>
<body>
  <script>
    // Khi t·∫£i trang, ki·ªÉm tra xem localStorage ƒë√£ c√≥ d·ªØ li·ªáu ch∆∞a
    if (!localStorage.getItem("xe")) {
      fetch("./Data/data.json")
        .then(res => res.json())
        .then(data => {
          // L∆∞u v√†o localStorage
          localStorage.setItem("xe", JSON.stringify(data));
          console.log("D·ªØ li·ªáu ƒë√£ n·∫°p t·ª´ data.json v√†o localStorage:", data);
        })
        .catch(err => console.error("L·ªói khi t·∫£i data.json:", err));
    } else {
      console.log("D·ªØ li·ªáu ƒë√£ c√≥ s·∫µn trong localStorage, kh√¥ng c·∫ßn n·∫°p l·∫°i.");
    }
  </script>

  <!-- Sau ƒë√≥ m·ªõi n·∫°p c√°c file JS kh√°c -->
  <script src="./Scripts/crud.js"></script>
  <script src="./Scripts/search.js"></script>
  <header>üöò Qu·∫£n l√Ω ƒëƒÉng k√Ω xe m√°y</header>

  <main>

    <!-- KHU V·ª∞C NH·∫¨P TH√îNG TIN -->
    <section class="form-section">
      <h2>üìÑ Th√¥ng tin ƒëƒÉng k√Ω xe</h2>

      <div class="form-row">
        <label for="ten">T√™n ch·ªß xe</label>
        <input id="ten" type="text" placeholder="Nh·∫≠p t√™n ch·ªß xe">
        <label for="diachi">ƒê·ªãa ch·ªâ</label>
        <input id="diachi" type="text" placeholder="Nh·∫≠p ƒë·ªãa ch·ªâ">
      </div>

      <div class="form-row">
        <label for="cmnd">S·ªë CMND</label>
        <input id="cmnd" type="text" placeholder="Nh·∫≠p s·ªë CMND">
        <label for="bienso">Bi·ªÉn s·ªë</label>
        <input id="bienso" type="text" placeholder="Nh·∫≠p bi·ªÉn s·ªë xe">
      </div>

      <div class="button-group">
        <button id="addBtn">Th√™m</button>
        <button id="editBtn">S·ª≠a</button>
        <button id="deleteBtn">X√≥a</button>
        <button id="viewRequestBtn">Xem y√™u c·∫ßu</button>
      </div>
    </section>

    <!-- KHU V·ª∞C T√åM KI·∫æM -->
    <section class="form-section">
      <h2>üîç T√¨m ki·∫øm</h2>
      <div class="search-section">
        <select id="searchType">
          <option value="ten">Theo t√™n</option>
          <option value="bienso">Theo bi·ªÉn s·ªë</option>
          <option value="diachi">Theo qu√™ qu√°n</option>
        </select>
        <input class="search-input" id="searchInput" type="text" placeholder="Nh·∫≠p t·ª´ kh√≥a...">
      </div>
    </section>

    <!-- KHU V·ª∞C DANH S√ÅCH -->
    <section class="table-section">
      <h2>üìã Danh s√°ch xe ƒë√£ ƒëƒÉng k√Ω</h2>
      <table>
        <thead>
          <tr>
            <th>STT</th>
            <th>T√™n ch·ªß xe</th>
            <th>ƒê·ªãa ch·ªâ</th>
            <th>S·ªë CMND</th>
            <th>Bi·ªÉn s·ªë</th>
          </tr>
        </thead>
        <tbody id="tableBody">
          <!-- D·ªØ li·ªáu s·∫Ω ƒë∆∞·ª£c JS render -->
        </tbody>
      </table>
      <div class="footer" id="countLabel">T·ªïng s·ªë xe: 0</div>
    </section>

    <section class="table-section" id="requestSection" style="display:none;">
  <h2>üì® Danh s√°ch y√™u c·∫ßu ph·∫£n h·ªìi</h2>
  <table>
    <thead>
      <tr>
        <th>·∫¢nh</th>
        <th>H·ªç v√† t√™n</th>
        <th>CMND</th>
        <th>Qu√™ qu√°n</th>
        <th>Ng√†y sinh</th>
      </tr>
    </thead>
    <tbody id="requestBody"></tbody>
  </table>
</section>



  </main>

  <!-- K·∫æT N·ªêI FILE JS -->
  <script type="module">
    import { renderTable, themXe, suaXe, xoaXe } from "./Scripts/crud.js";
    import { timTheoTen, timTheoBienSo, timTheoQueQuan } from "./Scripts/search.js";

    document.getElementById("viewRequestBtn").onclick = () => {
  const users = JSON.parse(localStorage.getItem("users")) || [];
  const filtered = users.filter(u => u.phanhoi === 1);

  const body = document.getElementById("requestBody");
  const section = document.getElementById("requestSection");
  body.innerHTML = "";

  if (filtered.length === 0) {
    body.innerHTML = `<tr><td colspan="5" style="text-align:center;color:gray;">Kh√¥ng c√≥ y√™u c·∫ßu n√†o</td></tr>`;
  } else {
    filtered.forEach(u => {
      const tr = document.createElement("tr");

      const imgSrc = u.imageBase64 || "./default-avatar.png"; // ·∫£nh m·∫∑c ƒë·ªãnh n·∫øu ch∆∞a c√≥

      tr.innerHTML = `
        <td style="text-align:center;"><img src="${imgSrc}" alt="avatar" width="60" height="60" style="border-radius:50%;object-fit:cover;"></td>
        <td>${u.ten}</td>
        <td>${u.cmnd}</td>
        <td>${u.quequan}</td>
        <td>${u.ngaysinh}</td>
      `;
      body.appendChild(tr);
    });
  }

  section.style.display = "block";
  section.scrollIntoView({ behavior: "smooth" });
};

    // Kh·ªüi t·∫°o b·∫£ng khi t·∫£i trang
    renderTable();

    // G√°n c√°c s·ª± ki·ªán CRUD
    document.getElementById("addBtn").onclick = () => {
      capNhatPhanHoi(cmnd.value,ten.value,diachi.value);
      themXe(ten.value, diachi.value, cmnd.value, bienso.value);

      
      document.getElementById("viewRequestBtn").onclick();
      capNhatTongXe();
    };

    document.getElementById("editBtn").onclick = () => {
      suaXe(ten.value, diachi.value, cmnd.value, bienso.value);
      capNhatTongXe();
    };

    document.getElementById("deleteBtn").onclick = () => {
      xoaXe();
      capNhatTongXe();
    };

    // document.getElementById("printBtn").onclick = () => {
    //   window.print();
    // };

    // T√¨m ki·∫øm ƒë·ªông
    const searchInput = document.getElementById("searchInput");
    const searchType = document.getElementById("searchType");

    searchInput.addEventListener("input", () => {
      const val = searchInput.value.trim();
      const type = searchType.value;

      if (val === "") {
        renderTable();
        return;
      }

      if (type === "ten") timTheoTen(val);
      else if (type === "bienso") timTheoBienSo(val);
      else timTheoQueQuan(val);
    });

    // C·∫≠p nh·∫≠t t·ªïng s·ªë xe
    function capNhatTongXe() {
      const data = JSON.parse(localStorage.getItem("xe")) || [];
      document.getElementById("countLabel").textContent = `T·ªïng s·ªë xe: ${data.length}`;
    }

    capNhatTongXe();
    // --- Xem y√™u c·∫ßu ph·∫£n h·ªìi ---
document.getElementById("viewRequestBtn").onclick = () => {
  const users = JSON.parse(localStorage.getItem("users")) || [];
  const filtered = users.filter(u => u.phanhoi === 1);

  const body = document.getElementById("requestBody");
  const section = document.getElementById("requestSection");
  body.innerHTML = "";

  if (filtered.length === 0) {
    body.innerHTML = `<tr><td colspan="5" style="text-align:center;color:gray;">Kh√¥ng c√≥ y√™u c·∫ßu n√†o</td></tr>`;
  } else {
    filtered.forEach(u => {
      const tr = document.createElement("tr");

      const imgSrc = u.avatar || "./default-avatar.png";

      tr.innerHTML = `
        <td style="text-align:center;"><img src="${imgSrc}" alt="avatar" width="60" height="60" style="border-radius:50%;object-fit:cover;"></td>
        <td>${u.ten}</td>
        <td>${u.cmnd}</td>
        <td>${u.quequan}</td>
        <td>${u.ngaysinh}</td>
      `;

      // üëá Khi click v√†o h√†ng => t·ª± ƒë·ªông ƒëi·ªÅn th√¥ng tin v√†o form
      tr.addEventListener("click", () => {
        document.getElementById("ten").value = u.ten;
        document.getElementById("cmnd").value = u.cmnd;
        document.getElementById("diachi").value = u.quequan;
        // Bi·ªÉn s·ªë v·∫´n ƒë·ªÉ tr·ªëng ƒë·ªÉ admin t·ª± nh·∫≠p
        window.scrollTo({ top: 0, behavior: "smooth" });
      });

      body.appendChild(tr);
    });
  }

  section.style.display = "block";
  section.scrollIntoView({ behavior: "smooth" });
};


  </script>
  <script>
    function capNhatPhanHoi(cmnd, hoten, diachi) {
  // L·∫•y danh s√°ch ng∆∞·ªùi d√πng t·ª´ localStorage
  let users = JSON.parse(localStorage.getItem("users")) || [];

  // T√¨m user c√≥ c√πng cmnd, h·ªç t√™n v√† ƒë·ªãa ch·ªâ
  for (let i = 0; i < users.length; i++) {
    if (
      users[i].cmnd === cmnd &&
      users[i].ten === hoten &&
      users[i].quequan === diachi
    ) {
      users[i].phanhoi = 0; // c·∫≠p nh·∫≠t l·∫°i phanhoi
      console.log("Tim thay");

      break;
    }
  }

  // L∆∞u l·∫°i danh s√°ch users sau khi ch·ªânh s·ª≠a
  localStorage.setItem("users", JSON.stringify(users));
};
  </script>

</body>
</html>